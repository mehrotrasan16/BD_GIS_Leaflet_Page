<!DOCTYPE html>
<html>

<head>
    <title>Full Screen Leaflet Map</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" crossorigin="" />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" crossorigin=""></script>

    <script src="./leaflet plugins/L.Modal.min.js"></script>
    <link rel="stylesheet" href="./leaflet plugins/leaflet.modal.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.js"></script>

    <style>
        body {
            padding: 0;
            margin: 0;
        }

        html,
        body,
        #map {
            height: 100%;
            width: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script>
        var map = L.map('map').setView([37.8, -96], 5);
        mapLink =
            '<a href="http://openstreetmap.org">OpenStreetMap</a>';
        L.tileLayer(
            'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; ' + mapLink + ' Contributors',
            maxZoom: 18,
        }).addTo(map);

        var popup = L.popup();
        function onMapClick(e) {
            popup
                .setLatLng(e.latlng)
                .setContent("You clicked the map at " + e.latlng.toString())
                .openOn(map);
                console.log("User clicked on point:" + e.latlng.toString())
        }

        map.on("click", onMapClick);
        
        function onMapZoom(e){
			console.log("User Changed zoom to value: " + map.getZoom())
			console.log("Zoom center on map: " + map.getCenter()) 
		}
		map.on("zoomend",onMapZoom);
		//L.control.scale().addTo(map);
		
		//map.on("zoomend", console.log(map.getZoom()));
    </script>
    <script>
        //Leaflet draw plugin

        //feature group to add the drawn shapes
        var drawnItems = new L.FeatureGroup();
        map.addLayer(drawnItems);

        var options = {
            position: "topleft",
            draw: {
                polygon: {
                    allowIntersection: false, // Restricts shapes to simple polygons
                    drawError: {
                        color: "#e1e100", // Color the shape will turn when intersects
                        message: "<strong>Oh snap!<strong> you can't draw that!", // Message that will show when intersect
                    },
                    shapeOptions: {
                        color: "#97009c",
                    },
                },
                polyline: {
                    shapeOptions: {
                        color: "#f357a1",
                        weight: 10,
                    },
                },
                // disable toolbar item by setting it to false
                polyline: true,
                circle: true, // Turns off this drawing tool
                polygon: true,
                marker: true,
                rectangle: true,
            },
            edit: {
                featureGroup: drawnItems, //REQUIRED!!
                remove: true,
            },
        };

        var drawControl = new L.Control.Draw(options);
        map.addControl(drawControl);


        map.on(L.Draw.Event.CREATED, function (e) {
			//draw:created 	PolyLine 	Polygon; Rectangle; Circle; Marker | String Layer that was just created. The type of layer this is. One of: polyline; polygon; rectangle; circle; marker Triggered when a new vector or marker has been created.
			//type = shape drawn
			//layer = details of the shape
			
            var type = e.layerType,
                layer = e.layer;
            if (type === 'marker') {
				console.log("Marker dropped.")
				console.log("Marker Location: " + e.layer._latlng)
				layer.bindPopup("Market at location:" + e.layer._latlng + "\n")
            }
            if (type === 'circle') {
				console.log("Circle drawn")
				console.log("E.Layer._latlng(i.e the centroid): " + e.layer._latlng)
				console.log("E.layer._mRadius(i.e. the radius): " +e.layer._mRadius)
            }
            if (type === 'rectangle') {
				console.log("Rectangle drawn")
				console.log("E.Layer._latlngs: " + e.layer._latlngs)
				console.log("Number of points, lat-long array length: " +e.layer._latlngs[0].length)
				console.log("E layer _latlngs object: " +e.layer._latlngs[0])
				
				var i = 0;
				for(i = 0 ; i < e.layer._latlngs[0].length; i++){
					console.log("Shape coordinate "+ i + ":" + e.layer._latlngs[0][i])
				}
            }
            if (type === 'polygon') {
				console.log(" Polygon drawn")
            }
            if (type === 'polyline') {
				console.log("Polyline drawn")
            }
            // Do whatever else you need to. (save to db; add to map etc)
            map.addLayer(layer);
        });
       
        
        map.on(L.Draw.Event.EDITED, function(e){
		//draw:edited 	LayerGroup 	List of all layers just edited on the map. Triggered when layers in the FeatureGroup; initialised with the plugin; have been edited and saved.
		
		});
		
		 map.on(L.Draw.Event.DELETED, function(e){
		//draw:deleted 	LayerGroup 	List of all layers just removed from the map. Triggered when layers have been removed (and saved) from the FeatureGroup.
		});
		
		/*
		draw:drawstart 	String 	The type of layer this is. One of:polyline; polygon; rectangle; circle; marker Triggered when the user has chosen to draw a particular vector or marker.
		draw:drawstop 	String 	The type of layer this is. One of: polyline; polygon; rectangle; circle; marker Triggered when the user has finished a particular vector or marker.
		draw:drawvertex 	LayerGroup 	List of all layers just being added from the map. Triggered when a vertex is created on a polyline or polygon.
		draw:editresize 	ILayer 	Layer that was just moved. Triggered as the user resizes a rectangle or circle.
		draw:deletestart 	String 	The type of edit this is. One of: remove Triggered when the user starts remove mode by clicking the remove tool button.
		draw:deletestop 	String 	The type of edit this is. One of: remove Triggered when the user has finished removing shapes (remove mode) and saves.
		draw:markercontext 	String 	Triggered when a marker is right clicked.
		*/
        
    </script>
    <script>
    //shape edit code
    var polygon = new L.Polygon([
			[37.07271, -109.094238],
			[36.958671, -104.501953],
			[37.952861, -100.83252]
		]);

		polygon.editing.enable();

		map.addLayer(polygon);

		var polyline = new L.Polyline([
			[51.50, -0.04],
			[51.49, -0.02],
			[51.51, 0],
			[51.52, -0.02]
		]);

		polyline.editing.enable();

		map.addLayer(polyline);
    polygon.on('edit', function() {
			console.log('Polygon was edited!');
		});
		polyline.on('edit', function() {
			console.log('Polyline was edited!');
		});
    </script>
    <script>
        var MyCustomMarker = L.Marker.extend({

            bindPopup: function (htmlContent, options) {

                if (options && options.showOnMouseOver) {

                    // call the super method
                    L.Marker.prototype.bindPopup.apply(this, [htmlContent, options]);

                    // unbind the click event
                    this.off("click", this.openPopup, this);

                    // bind to mouse over
                    this.on("mouseover", function (e) {

                        // get the element that the mouse hovered onto
                        var target = e.originalEvent.fromElement || e.originalEvent.relatedTarget;
                        var parent = this._getParent(target, "leaflet-popup");

                        // check to see if the element is a popup, and if it is this marker's popup
                        if (parent == this._popup._container)
                            return true;

                        // show the popup
                        this.openPopup();

                    }, this);

                    // and mouse out
                    this.on("mouseout", function (e) {

                        // get the element that the mouse hovered onto
                        var target = e.originalEvent.toElement || e.originalEvent.relatedTarget;

                        // check to see if the element is a popup
                        if (this._getParent(target, "leaflet-popup")) {

                            L.DomEvent.on(this._popup._container, "mouseout", this._popupMouseOut, this);
                            return true;

                        }

                        // hide the popup
                        this.closePopup();

                    }, this);

                }

            },

            _popupMouseOut: function (e) {

                // detach the event
                L.DomEvent.off(this._popup, "mouseout", this._popupMouseOut, this);

                // get the element that the mouse hovered onto
                var target = e.toElement || e.relatedTarget;

                // check to see if the element is a popup
                if (this._getParent(target, "leaflet-popup"))
                    return true;

                // check to see if the marker was hovered back onto
                if (target == this._icon)
                    return true;

                // hide the popup
                this.closePopup();

            },

            _getParent: function (element, className) {

                var parent = element.parentNode;

                while (parent != null) {

                    if (parent.className && L.DomUtil.hasClass(parent, className))
                        return parent;

                    parent = parent.parentNode;

                }

                return false;

            }

        });


        var markers = new L.FeatureGroup();

        function getRandomLatLng(map) {
            var bounds = map.getBounds(),
                southWest = bounds.getSouthWest(),
                northEast = bounds.getNorthEast(),
                lngSpan = northEast.lng - southWest.lng,
                latSpan = northEast.lat - southWest.lat;

            return new L.LatLng(
                southWest.lat + latSpan * Math.random(),
                southWest.lng + lngSpan * Math.random());
        }



        function populate() {
            //for (var i = 0; i < 10; i++) {
            //    var marker = new MyCustomMarker(getRandomLatLng(map));
            //    marker.bindPopup("<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque volutpat mattis eros. Nullam malesuada erat ut turpis. Suspendisse urna nibh, viverra non, semper suscipit, posuere a, pede.</p><p>Donec nec justo eget felis facilisis fermentum. Aliquam porttitor mauris sit amet orci. Aenean dignissim pellentesque.</p>", {
            //        showOnMouseOver: true
            //    });
            //    markers.addLayer(marker);
            //}
            horsetooth = new MyCustomMarker([40.55268, -105.15461]);
            horsetooth.bindPopup("This is Horsetooth Resevoir, CO.", { showOnMouseOver: true });

            fossilcreek = new MyCustomMarker([40.48913, -105.01256]);
            fossilcreek.bindPopup("This is fossil creek Resevoir, CO.", { showOnMouseOver: true });

            winsdor = new MyCustomMarker([40.53455, -104.88733]);
            winsdor.bindPopup("This is winsdor Resevoir, CO.", { showOnMouseOver: true });

            timnath = new MyCustomMarker([40.5459, -104.96098]);
            timnath.bindPopup("This is timnath Resevoir, CO.", { showOnMouseOver: true });


            markers.addLayer(horsetooth);
            markers.addLayer(fossilcreek);
            markers.addLayer(winsdor);
            markers.addLayer(timnath);
            return false;
        }

        map.addLayer(markers);

        populate();
    </script>
    <script>
    
    </script>

</body>

</html>
