(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{249:function(e,t,n){"use strict";n.d(t,"a",function(){return f});var r,a,o=n(0),i=n(12),c=function(e){var t,n,o,i=(t=e,n=t.touches,o=t.originalEvent,n||o.touches)[0];r=i.clientX,a=i.clientY},l=function(e){var t=e.touches;if(r&&a){var n=t[0].clientX,o=t[0].clientY,c=r-n,l=a-o;Math.abs(c)>Math.abs(l)||l>0||l<0&&Object(i.g)({minimized:!0}),r=null,a=null}},s=function(){var e=document.getElementById("relay-nav-bar");e&&(e.removeEventListener("touchstart",c,!1),e.removeEventListener("touchmove",l,!1))},u=function(){var e;return(e=document.getElementById("relay-nav-bar"))&&(e.addEventListener("touchstart",c,!1),e.addEventListener("touchmove",l,!1)),s},f=function(){return o.useEffect(u)}},261:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(0),a=n(26),o=function(){var e=r.useState(!1),t=e[0],n=e[1],o=r.useCallback(function(e){var t=document.getElementsByClassName("relay-popup")[0];if(t){if(e){var r=t.getBoundingClientRect(),a=r.bottom,o=r.top,i=r.left,c=r.right,l=e.clientX,s=e.clientY;if(l>i&&l<c&&s>o&&s<a)return}n(!1)}},[]),i=r.useCallback(function(){var e=document.getElementById("relay");e&&e.removeEventListener("click",o)},[]);r.useEffect(function(){var e=document.getElementById("relay");if(e)return t?(e.addEventListener("click",o),Object(a.k)(document.getElementsByClassName("relay-popup")[0])):e.removeEventListener("click",o),i},[t]);var c=r.useCallback(function(e){e&&e.stopPropagation&&e.stopPropagation(),n(!t)},[t]);return{closePopup:o,togglePopup:c,isPopupOpen:t}}},269:function(e,t,n){"use strict";var r=n(0),a=n(273),o=n(3),i={width:80,minWidth:80,maxWidth:80,height:25},c={width:120,height:35},l={width:"auto",minWidth:"auto",maxWidth:"auto",height:25};t.a=function(e){var t=e.label,n=e.cb,s=e.inbox,u=void 0!==s&&s,f=e.classNames,m=void 0===f?[]:f,d=i;return o.b?d=c:u&&(d=l),r.createElement(a.a,{style:d,onClick:n,className:"relay-popup-button "+m.join(" ")},t)}},283:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),a=function(e){var t=r.useRef();return r.useEffect(function(){t.current=e}),t.current}},306:function(e,t,n){"use strict";var r=n(0),a=n.n(r),o=n(319),i=n(41),c=n(246),l=n(373),s=n.n(l),u=n(483),f=n(385),m=n.n(f),d=n(8),p={flag_wrapper:{padding:0,boxShadow:"none",height:"100%",width:"auto"},flag:{height:18,color:d.f}},g=function(e){var t=e.flagged,n=e.deleteFlag;return t&&r.createElement(u.a,{style:p.flag_wrapper,onClick:n},r.createElement(m.a,{style:p.flag}))},h=n(105),b=function(e){var t=e.user,n=t.role,r=t.gild_count,a=t.join_time;return n&&a?"\n      <div style='display:flex;flex-direction:column;'>"+("vip"===n?"<strong style='margin-bottom:4px;'>Top contributor</strong>":"bot"===n?"<strong style='margin-bottom:4px;'>Bot</strong>":"")+"<p style='margin-bottom:4px;'>"+r+" star"+(1===r?"":"s")+"</p><p>Joined "+h(a).format("MMM YYYY")+"</p></div>":""},v=n(396),y=n.n(v),k=n(386),E=n.n(k),j=n(388),O=n.n(j),C=function(){return(C=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},x={gild:{marginLeft:2,height:"100%"},star:{height:18,color:d.e,width:20},gildCountWrapper:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},gildCount:{fontSize:12,color:d.e,fontFamily:"Roboto",position:"relative",right:2}},w=function(e){var t=e.gildCount,n=e.mine,a=e.onClick,o=e.isProfile,i=e.active;return r.createElement(r.Fragment,null,!o&&r.createElement(O.a,{defaultStyle:{rotate:i?-360:0},style:{rotate:E()(i?-360:0,{stiffness:120,damping:7})}},function(e){var i=e.rotate;return r.createElement("div",{style:x.gildCountWrapper},r.createElement(u.a,{style:x.gild,disabled:n||o,onClick:a,className:"star "+(t?"active":"")},r.createElement(y.a,{style:C({},x.star,{color:t?"#ffd636":d.e,transform:"rotate("+i+"deg)"})})),t&&r.createElement("span",{style:x.gildCount},"x"+t))}))},_=n(269),S={backgroundColor:d.h,color:d.b,position:"absolute",opacity:1,borderRadius:3,paddingTop:2,paddingBottom:2,zIndex:1,display:"flex",flexDirection:"column"},P=function(){return(P=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},I=function(e){var t=e.sendMessage,n=e.flag,a=e.alreadyFlagged,o=e.goToProfile,i=e.isDM,c=e.isBot;return r.createElement("div",{style:P({},S,{left:0,top:23}),className:"relay-popup"},!i&&!c&&r.createElement(_.a,{label:"Message",cb:t}),r.createElement(_.a,{label:"Profile",cb:o}),!a&&!i&&r.createElement(_.a,{label:"Report",classNames:["red"],cb:n}))},R=n(26),T=n(42),L=n(12),B=n(10),N=n(96),M=n(261),F=n(283),D=n(27),z=function(){return(z=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},U={container:{display:"flex",width:"100%",position:"relative",marginBottom:2,alignItems:"center",justifyContent:"space-between"},username:{fontSize:16,fontWeight:500,maxWidth:200,textOverflow:"ellipsis",overflowX:"hidden"},left:{float:"left",marginTop:"auto",marginBottom:"auto",display:"flex",position:"relative"},right:{position:"absolute",margin:0,padding:0,right:0,display:"flex",alignItems:"center"},inserted_at:{marginLeft:6,opacity:.5,marginTop:0,display:"flex",alignItems:"center"},flag_wrapper:{margin:"0 20px 0 7px",padding:0,boxShadow:"none",height:"auto",width:"auto",bottom:2},flag:{height:12,width:12}},W=Object(i.b)(function(e){var t=e.storage,n=e.room;return{directRoomId:t.directRoomId,loggedIn:!!t.token,userRole:t.userRole,profileId:t.profileId,room:n}},function(e){return{createFlag:function(t){return e(Object(B.b)(t))},deleteFlag:function(t){return e(Object(B.d)(t))}}})(Object(o.a)(function(e){var t=e.message,n=e.room,a=e.loggedIn,o=e.createFlag,i=e.deleteFlag,l=e.profileId,u=e.history,f=e.location,m=e.userRole,d=e.directRoomId,p=Object(F.a)(t),h=Object(M.a)(),v=h.isPopupOpen,y=h.togglePopup,k=h.closePopup,E=r.useState(!1),j=E[0],O=E[1];r.useEffect(function(){l&&Object(L.g)({scene:"profile"})},[l]),r.useEffect(function(){p&&t.gild_count!==p.gild_count&&t.mine&&O(!j)},[t,j]);var C=n.channel,x=t.inserted_at,_=t.user,S=t.mine,P=t.flagged,B=t.gild_count,W=_.username,Y=_.role,A=r.useCallback(function(e){u.push({pathname:"/signup",state:{authReason:(e||"message")+" "+W}}),Object(L.g)({scene:"signup"})},[t]),H=r.useCallback(function(){if(!a)return A("View Profile");k(),u.push({pathname:"/profile",state:{profileUsername:_.username,profileId:_.id}}),Object(L.g)({scene:"profile",profileUsername:_.username,profileId:_.id})},[t,a,u]),X=r.useCallback(function(){if(k(),!a)return A();var e=t.user.id;Object(T.h)(e).then(function(t){var n=t.id;if("Too Many Requests"===t)return Object(R.f)();if(["unauthorized","unauthenticated"].includes(t.message))return A();d!==n&&Object(L.g)({directRoomId:n});var r={pathname:"/direct_chat",roomId:n};n||(r.recipient_username=W,r.recipient_id=e),u.push(r)}).catch(console.error)},[t,d,a,u]),J=r.useCallback(function(){if(!a)return A("gild");C&&C.push("gild_message",Object(c.a)(t,["id","bucket"])).receive("ok",function(){O(!j),Object(D.b)("Gild","Message",n.name)}).receive("error",function(e){var t=e.reason;"unauthorized"===t?A("gild"):"rate_limited"===t&&Object(R.e)("You can only star "+("vip"===m?10:5)+" times every fifteen minutes")}),k()},[m,j,n,t,a]),K=r.useCallback(function(){if(!a)return A("flag");C&&C.push("create_flag",{message_id:t.id,message_text:t.text,author_id:t.user.id,author_username:t.user.username,room_bucket:t.bucket,room_name:n.name}).receive("ok",function(){return o(t.id)}).receive("error",function(e){var t=e.reason;"unauthorized"===t?A("flag"):"rate_limited"===t&&Object(R.f)()}),k()},[t,n,a,o]),V=r.useCallback(function(){return C&&C.push("delete_flag",{room_name:n.name,message_id:t.id}).receive("ok",function(){return i(t.id)}).receive("error",function(e){"rate_limited"===e.reason&&Object(R.f)()})},[n,t,i]),q="/profile"===f.pathname,G=!S&&!q,Q=q?t.room_name:W,Z=Object(R.m)(Q),$="vip"===Y,ee="bot"===Y;return r.createElement("div",{style:U.container},r.createElement("div",{style:z({},U.left,{color:Z})},r.createElement("p",{onClick:G?y:void 0,style:z({color:Z},U.username),className:G?($?"vip-username":"")+" relay-username":$&&!q?"vip-username":"","data-tip":b({user:_}),"data-tip-disable":q,"data-html":!0},Q),v&&G&&r.createElement(I,{flag:K,sendMessage:X,alreadyFlagged:P,goToProfile:H,isDM:"/direct_chat"===f.pathname,isBot:ee}),"/chat"===f.pathname&&r.createElement(r.Fragment,null,r.createElement(w,{onClick:J,gildCount:B,mine:S,isProfile:q,active:j}),!S&&!q&&r.createElement(g,{flagged:t.flagged,deleteFlag:V}))),r.createElement("p",{style:z({},N.g,U.inserted_at)},Object(R.i)(x)),r.createElement(s.a,{place:"top","data-html":!0}))})),Y=n(397),A=n.n(Y),H=n(109),X=function(e,t){for(var n,r={};n=t.exec(e);){var a=n.index;r[a-2]||(r[a]=a+n[1].length)}return r},J=function(e,t,n){void 0===n&&(n=!1);for(var r=[],o=X(e,/(:[\w|-]+:)/g),i=Object.keys(o).concat([e.length]).sort(function(e,t){return e-t}),c=0,l=0;i.length;){var s=i[0],u=o[s];c!=s&&r.push(e.slice(c,s));var f=e.slice(s,u);if(f.length){var m=t[f],d=n||f.length!==e.length?{height:16}:{height:26},p=H.a[e.slice(1,-1)];p&&(f=p),r.push(m?a.a.createElement("span",{style:{verticalAlign:"middle"},key:l},a.a.createElement("img",{src:m,style:d,title:f})):f)}c=u,i.shift(),l+=1}return r},K=function(e){for(var t=e.text,n=e.onClickLink,o=e.colonsToImageUrl,i=function(e){for(var t=X(e,/(`[^`]+`)/g),n=X(e,/(```[^`]+```)/g),r=Object.keys(n).map(function(e){return parseInt(e)}).concat(Object.keys(t).map(function(e){return parseInt(e)}),[e.length]).sort(function(e,t){return e-t}),o=[],i=0,c=0;r.length;){var l=r[0],s=n[l]?3:1,u=n[l]||t[l];if(i!==l){var f=e.slice(i,l);o.push(f)}var m=e.slice(l+s,u-s).trim();m.length&&o.push(a.a.createElement("code",{className:3===s?"block":"",key:c},m)),i=u,r.shift(),c+=1}return o}(t),c=[],l=0;l<i.length;l++){var s=i[l];"string"==typeof s?c.push.apply(c,J(s,o)):c.push(s)}return r.createElement(A.a,{onClick:n},c)},V=n(3),q=function(){return(q=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},G={text:{fontFamily:"Roboto",color:"#F0F0F0",alignItems:"center",wordWrap:"break-word",maxWidth:V.b?"100%":330,display:"inline-block",margin:0,whiteSpace:"pre-wrap"},edited:{opacity:.5}},Q=Object(i.b)(function(e){return{colonsToImageUrl:e.emojis.colonsToImageUrl}})(function(e){var t=e.text,n=e.edited,a=e.onClickLink,o=e.colonsToImageUrl,i=H.b.has(t.trim()),c=!!o[t];return r.createElement("pre",{style:q({},G.text,{fontSize:i?26:14,lineHeight:i||c?1:1.5})},r.createElement(K,{text:t,onClickLink:a,colonsToImageUrl:o}),n&&r.createElement("span",{style:q({},N.g,G.edited)}," (edited)"))}),Z=n(284),$=n.n(Z),ee=function(){return(ee=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},te=function(e){var t=e.openEdit,n=e.message,a=e.deleteMessage,o=e.canPin,i=e.pin,c=Object(M.a)().closePopup,l=r.useState(!1),s=l[0],u=l[1],f=r.useCallback(function(){return u(!0)},[]);return r.createElement("div",{style:ee({},S,{right:0,top:21}),className:"relay-popup"},o&&!s&&r.createElement(_.a,{label:"Pin",cb:i}),s?r.createElement(r.Fragment,null,r.createElement(_.a,{label:"Yes, Delete",classNames:["red"],cb:a}),r.createElement(_.a,{label:"Cancel",cb:c})):r.createElement(r.Fragment,null,r.createElement(_.a,{label:"Edit",cb:t.bind(null,n.id)}),r.createElement(_.a,{label:"Delete",classNames:["red"],cb:f})))},ne=n(103),re=n(106),ae=function(){return(ae=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},oe={right:{margin:0,padding:0,display:"flex",flexDirection:"row",alignItems:"center",alignSelf:"flex-end",position:"absolute",right:24},toggle_wrapper:{boxShadow:"none",height:"auto",padding:0,width:"auto",marginRight:0,marginTop:0,marginBottom:0,position:"relative",alignSelf:"flex-start",left:5},toggle:{height:15,color:d.e}},ie=Object(i.b)(function(e){return{currentUserRole:e.storage.userRole}})(Object(o.a)(function(e){var t=e.openEdit,n=e.isBeingEdited,a=e.message,o=e.channel,i=e.location,c=e.currentUserRole,l=e.pinToChannel,s=Object(M.a)(),f=s.closePopup,m=s.togglePopup,d=s.isPopupOpen,p=r.useCallback(function(e){t(e),f()},[t]),g=r.useCallback(function(){o.push("delete_message",{id:a.id,bucket:a.bucket}).receive("ok",function(e){Object.keys(e).length>0&&("/chat"===i.pathname?Object(ne.c)(e):Object(re.b)(e)),f()}).receive("error",function(e){"rate_limited"===e.reason&&Object(R.f)()})},[a,o,i]),h=r.useCallback(function(){return l().receive("ok",function(e){f()})},[l]),b={opacity:0};return d&&(b.opacity=1),r.createElement("div",{style:ae({},b,oe.right),className:"relay-toggle"},n||r.createElement(u.a,{style:oe.toggle_wrapper,onClick:m,className:"relay-msg-owner-toggle"},r.createElement($.a,{style:oe.toggle})),d&&r.createElement(te,{deleteMessage:g,message:a,openEdit:p,pin:h,canPin:"vip"===c}))})),ce=n(307),le=function(){return(le=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},se=function(e){return window.parent.postMessage({relayRedirect:e},"*")},ue={container:{flexDirection:"column",backgroundColor:d.b,width:"100%",paddingLeft:20,paddingRight:20,display:"flex",justifyContent:"center"},escape:{opacity:.5},escape_link:{textDecoration:"underline"}};t.a=Object(i.b)(function(e){return{room:e.room.name}})(Object(o.a)(function(e){var t=e.channel,n=e.message,a=e.closeEdit,o=e.location,i=e.room,c=e.isBeingEdited,l=e.openEdit,s=e.openPicker,u=e.hasHeading,f=e.closePicker,m=e.isPickerOpen,d=e.onClick,p=r.useCallback(function(e){var r=n.id,i=n.bucket;e.length&&t.push("edit_message",{id:r,text:e,bucket:i}).receive("ok",function(e){a(),Object.keys(e).length>0&&("/chat"===o.pathname?Object(ne.d)(e):Object(re.c)(e))}).receive("error",function(e){"rate_limited"===e.reason&&Object(R.e)("You're doing that too much")})},[t,n,a,o]),g=r.useCallback(function(){return t.push("pin_message",{message_id:n.id,bucket:n.bucket,room_name:i}).receive("error",function(e){"rate_limited"===e.reason&&Object(R.e)("You can only pin a message once per hour")})},[t,n,i]),h=r.useCallback(function(){return d&&d(n)},[d,n]),b=n.text,v=n.edited,y=n.mine;return r.createElement("div",{style:le({},ue.container,{cursor:"/profile"===o.pathname?"pointer":"default"}),className:"relay-msg "+(u?"with-heading":""),onClick:h},u&&r.createElement(W,{message:n,channel:t}),c?r.createElement(ce.a,{isPickerOpen:m,onSubmit:p,textToEdit:b,closeEdit:a,openPicker:s,closePicker:f}):r.createElement(Q,{text:b,edited:v,onClickLink:se}),y&&r.createElement(ie,{message:n,openEdit:l,isBeingEdited:c,channel:t,pinToChannel:g}),c&&r.createElement("span",{style:le({},N.g,ue.escape_link,{fontSize:V.b?16:12}),className:"relay-escape-editing",onClick:a},V.b?"Tap to cancel":"Escape to cancel"))}))},307:function(e,t,n){"use strict";var r=n(0),a=n.n(r),o=n(319),i=n(41),c=n(8),l={selection:{display:"flex",justifyContent:"space-between",padding:"10px 20px",cursor:"pointer"},main:{fontSize:14,color:c.h},sub:{fontSize:12,color:c.e,opacity:.5,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:250}},s=n(105),u=n.n(s),f=n(270),m=n.n(f),d=function(){return(d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};u.a.extend(m.a);var p=function(e){var t=e.item,n=e.selectedIndex,r=e.onSelect,o=e.index;return a.a.createElement("div",{style:d({},l.selection,{backgroundColor:o===n?"rgba(0, 0, 0, 0.1)":"transparent"}),onClick:r.bind(null,t),className:"selection"},a.a.createElement("p",{style:l.main},"@"+t.username),a.a.createElement("p",{style:l.sub},u()(t.lastActive).fromNow()))},g=function(){return(g=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},h=function(e){var t=e.item,n=e.selectedIndex,r=e.onSelect,o=e.index;return a.a.createElement("div",{style:g({},l.selection,{backgroundColor:o===n?"rgba(0, 0, 0, 0.1)":"transparent"}),onClick:r.bind(null,t),className:"selection"},a.a.createElement("p",{style:l.main},t.colons),t.native?a.a.createElement("p",{style:{height:16,display:"flex",alignItems:"center"}},t.native):a.a.createElement("img",{style:{height:16},src:t.imageUrl}))},b=n(3),v=function(){return(v=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},y=function(e){var t=e.item,n=e.selectedIndex,r=e.onSelect,o=e.index;return a.a.createElement("div",{style:v({},l.selection,{backgroundColor:o===n?"rgba(0, 0, 0, 0.1)":"transparent"}),onClick:r.bind(null,t),className:"selection"},a.a.createElement("p",{style:l.main},t.literal),a.a.createElement("p",{style:l.sub},t.description))},k=function(){return(k=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},E={container:{position:"absolute",backgroundColor:c.a,width:"100%"}},j=function(e){var t=e.items,n=e.onSelect,r=e.input,o=e.onTab,i=e.type,c=void 0===i?"mention":i,l=a.a.useState(0),s=l[0],u=l[1],f=a.a.useState(!1),m=f[0],d=f[1],g=a.a.useState(!1),v=g[0],j=g[1],O=a.a.useRef(),C=a.a.useRef();a.a.useEffect(function(){return u(0)},[t]);var x=a.a.useCallback(function(e){if(!m&&O.current&&e.target!==r){var t=O.current.getBoundingClientRect(),n=t.bottom,a=t.top,o=t.left,i=t.right,c=e.clientX,l=e.clientY;c>o&&c<i&&l>a&&l<n||d(!0)}},[O,r,m]),w=a.a.useCallback(function(){return d(!1)},[]),_=a.a.useCallback(function(e){var r=e.keyCode,a=s;r>36&&r<41?(r>38?(a+=1)>t.length-1&&(a=0):r<39&&(a-=1)<0&&(a=t.length-1),u(a)):13!==r||e.shiftKey?(9===r||32===r&&b.b||13==r)&&!v&&(e.preventDefault(),j(!0),o(t[s])):n(t[s]),v&&j(!1)},[s,t,n,o,v]);return a.a.useEffect(function(){if(r)return C.current=document.getElementById("relay")||void 0,r.addEventListener("focus",w),r.addEventListener("keyup",_),C.current&&C.current.addEventListener("click",x),function(){r&&r.removeEventListener("focus",w),r&&r.removeEventListener("keyup",_),C.current&&C.current.removeEventListener("click",x)}},[r,x,w,_]),m?null:a.a.createElement("div",{style:k({},E.container,{top:-36*t.length})},t.map(function(e,t){var r={onSelect:n,selectedIndex:s,key:t,index:t};return"mention"===c?a.a.createElement(p,k({item:e},r)):"emoji"===c?a.a.createElement(h,k({item:e},r)):"macro"===c?a.a.createElement(y,k({item:e},r)):void 0}))},O=n(26),C=n(484),x=[{literal:"/feedback",description:"send us feedback and bug reports"},{literal:"/share",description:"send Relay to your friends"}],w=function(e,t){for(var n="",r=e.length-1;r>-1;r--){var a=e.charAt(r);if(a===t)return[r,n];n=a+n}},_=function(e){return w(e,"@")},S=function(e){return w(e,":")},P=function(e){9===e.keyCode&&e.preventDefault()},I=function(e){if(b.b)if(e)setTimeout(function(){var e=document.getElementById("relay-edit-message");e&&e.scrollIntoView()},250);else for(var t=1;t<8;t++)setTimeout(function(){var e=document.getElementsByClassName("simplebar-content")[0];e&&e.scroll({top:9999999})},100*t)},R=function(e){13!==e.keyCode||e.shiftKey||e.preventDefault()},T=n(410),L=n(415),B=n(414),N=n.n(B),M=n(483),F={emoji_toggle:{fontSize:25,alignSelf:"center",filter:"grayscale(100%)",opacity:.5,marginRight:15,cursor:"pointer",transform:".1s ease -in -out, opacity .1s ease -in -out, filter .1s ease -in -out"},send:{color:c.e}},D=function(e){var t=e.onSubmit,n=e.toggleEmoji,r=e.showEdit,o=e.onOpenPicker,i=e.resetToggleEmoji;return b.b?a.a.createElement(M.a,{onClick:t,id:"mobile-send-button",style:{position:r?"absolute":"static",right:0,padding:"0 20px",height:"100%"}},a.a.createElement(N.a,{style:F.send})):a.a.createElement("div",{style:F.emoji_toggle,onMouseEnter:i,onClick:o,className:r?"relay-emoji-toggle relay-emoji-toggle-edit":"relay-emoji-toggle"},n)},z=n(135),U=n(109),W=n(27),Y=n(42),A=n(12),H=function(){return(H=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},X={container:{display:"flex",backgroundColor:c.c,borderBottomLeftRadius:3,borderBottomRightRadius:3,minHeight:50,alignItems:"center",position:"relative",boxSizing:"content-box",height:"auto"},input:{color:"rgba(255, 255, 255, 0.8)",padding:"17px 10px 17px 20px",justifyContent:"center",fontSize:14,flex:1,borderWidth:0,boxShadow:"none",margin:0,backgroundColor:c.c,maxHeight:380,overflow:"hidden",resize:"none"},icon:{height:22.5,width:30,color:c.d},icon_wrapper:{boxShadow:"none",padding:0,marginRight:4,height:50,width:50}};t.a=Object(i.b)(function(e){var t=e.room,n=e.emojis;return{usernames:t.usernames,colonsToImageUrl:n.colonsToImageUrl}})(Object(o.a)(function(e){var t=e.room,n=e.usernames,a=e.textToEdit,o=e.onHeightChange,i=e.onSubmit,c=e.closeEdit,l=e.location,s=e.history,u=e.closePicker,f=e.isPickerOpen,m=e.openPicker,d=e.colonsToImageUrl,p=r.useState(50),g=p[0],h=p[1],v=r.useState(Object(O.j)()),y=v[0],k=v[1],E=r.useState(a||""),B=E[0],N=E[1],M=r.useState(!1),F=M[0],J=M[1],K=r.useState(!1),V=K[0],q=K[1],G=r.useState(!1),Q=G[0],Z=G[1],$=r.useRef(),ee=r.useRef(!1),te=r.useCallback(function(){return a?"relay-edit-message":"relay-message"},[a]);r.useEffect(function(){var e;try{e=sessionStorage.getItem("RELAY_DRAFT_"+t)}catch(e){}e&&N(e)},[t]);var ne=r.useCallback(function(){try{sessionStorage.setItem("RELAY_DRAFT_"+t,B)}catch(e){}},[t,B]),re=r.useCallback(function(){var e=_(B);return e?function(e,t){return Object(C.a)(Object.keys(e),function(e){return e.startsWith(t)}).map(function(t){return{username:t,lastActive:e[t]}}).sort(function(e,t){return t.lastActive-e.lastActive}).slice(0,5)}(n,e[1]):[]},[B,n]),ae=r.useCallback(function(){var e,t=w(B,"/");return t?(e=t[1],Object(C.a)(x,function(t){return t.literal.startsWith("/"+e)})):[]},[B]),oe=r.useCallback(function(){var e=S(B);if(!e)return[];var t=z.a.getPrefix(":"+e[1]),n=[];return t.forEach(function(e){var t=d[e],r=U.a[e.slice(1,-1)];(t||r)&&n.push({colons:e,imageUrl:t,native:r})}),n.slice(0,5)},[B,d]),ie=r.useCallback(function(){N(""),h(50);try{sessionStorage.clear()}catch(e){}},[]),ce=r.useCallback(function(e){e.preventDefault(),27===e.keyCode&&c&&(u(),c())},[c,u]),le=r.useCallback(function(){return k(Object(O.j)())},[]);r.useEffect(function(){f&&$.current&&$.current.focus},[f]);var se=r.useCallback(function(e){var t=e.native,n=e.colons,r=$.current&&$.current.value||B,a=t||n.replace(/\s/g,"_");N((""+r+a).slice(0,500)),Object(W.b)("EmojiPicker",a),$.current&&$.current.focus()},[B,$]),ue=r.useCallback(function(e,t){f&&u(),b.b&&$.current&&$.current.focus(),t||!e&&!b.b?"/feedback "===B.slice(0,"/feedback ".length)?(Object(Y.g)(B.slice("/feedback ".length)).catch(console.error),Object(O.e)("Thank you for your feedback!"),N("")):(q(!1),J(!1),Z(!1),i(B,ie)):N((B+"\n").slice(0,500))},[u,f,B,i,ie]),fe=r.useCallback(function(){return ue(!1,!0)},[ue]),me=r.useCallback(function(e){e.preventDefault(),13!==e.keyCode||F&&re().length||V&&oe().length||Q&&ae().length||ue(e.shiftKey)},[F,V,Q,re,oe,ue]);r.useEffect(function(){return $.current&&($.current.addEventListener("keyup",me),$.current.addEventListener("keydown",R),(!ee&&"/direct_chat"===l.pathname||a)&&(ee.current=!0,$.current.focus())),document.addEventListener("keyup",ce),document.addEventListener("keydown",P),function(){$.current&&($.current.removeEventListener("keyup",me),$.current.removeEventListener("keydown",R)),document.removeEventListener("keyup",ce),document.removeEventListener("keydown",P),ne()}},[me,ce,P,a,$,ne,ee]);var de=r.useCallback(function(){N("");try{sessionStorage.clear()}catch(e){}Object(A.g)({scene:"share"}),s.push("/share")},[s]),pe=r.useCallback(function(e){var t=_(B);if(t){var n=t[0],r=(t[1],e&&e.username);return!!r&&(J(!1),N(B.slice(0,n+1)+r),Object(W.b)("MentionAutocomplete"),!0)}},[B]),ge=r.useCallback(function(e){var t=S(B);if(t){var n=t[0],r=(t[1],e&&e.colons);return!!r&&(q(!1),N(Object(T.emojify)(B.slice(0,n)+r)),Object(W.b)("EmojiAutocomplete",r),!0)}},[B]),he=r.useCallback(function(e){return Object(W.b)("MacroAutocomplete",e.literal),"/share"===e.literal&&de(),Z(!1),N(e.literal),!0},[de]),be=r.useCallback(function(e){var t=e.target.value;if("/share"===t)de();else if(t.length>500)return Object(O.d)();var n=t.slice(-1),r=t.slice(-2,-1),a=" "===r||"\n"===r||""===r;":"===n&&(t=Object(T.emojify)(t)),":"===n&&a?q(!0):"@"===n&&"/chat"===l.pathname&&a?J(!0):a&&(J(!1),q(!1),Z(!1)),"/"===n&&1===t.length&&Z(!0),N(t.slice(0,500))},[l,de]),ve=r.useCallback(function(e){return m(se)},[m,se]),ye=r.useCallback(function(){if(B.length&&$.current){var e=Math.max($.current.clientHeight,50);h(e),o&&o(e)}},[B,$,o]);return r.createElement("form",{style:H({},X.container,{height:g}),autoComplete:"new-password",className:a?"relay-edit-message-form":"relay-message-form",onFocus:I.bind(null,!!a)},F&&r.createElement(j,{items:re(),onSelect:pe,input:$.current,onTab:pe,type:"mention"}),V&&r.createElement(j,{items:oe(),onSelect:ge,input:$.current,onTab:ge,type:"emoji"}),Q&&r.createElement(j,{items:ae(),onSelect:he,input:$.current,onTab:he,type:"macro"}),r.createElement(L.a,{id:te(),placeholder:B?"":"Message "+t,type:"text",value:B,onChange:be,style:X.input,name:"input",onHeightChange:ye,maxRows:8,useCacheForDOMMeasurements:!0,inputRef:function(e){$.current=e}}),r.createElement(D,{onSubmit:fe,toggleEmoji:y,showEdit:!!a,onOpenPicker:ve,resetToggleEmoji:le}))}))}}]);